<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Johnson Contract Editor</title>
    <link rel="stylesheet" href="css/editor-styles.css">
    <script src="Tools/node_modules/papaparse/papaparse.min.js"></script>
</head>
<body>
    <!-- Main Editor Container -->
    <div class="editor-container">
        <!-- Top Toolbar -->
        <div class="toolbar">
            <!-- File Controls -->
            <div class="toolbar-section file-controls">
                <button class="btn-primary" id="newContractBtn">New Contract</button>
                <button class="btn-primary" id="openContractBtn">Open Contract</button>
                <input type="file" id="fileInput" accept=".csv" style="display: none;">
                <button class="btn-primary" id="saveContractBtn">Save Contract</button>
            </div>

            <!-- Canvas Controls -->
            <div class="toolbar-section canvas-controls">
                <button class="btn-secondary" id="gridToggleBtn">Toggle Grid</button>
                <button class="btn-secondary" id="snapToggleBtn">Snap to Grid</button>
                <button class="btn-secondary" id="buildConnectionsBtn">Build Connections</button>
                <button class="btn-secondary" id="zoomFitBtn">Zoom to Fit</button>
                <button class="btn-secondary" id="resetViewBtn">Reset View</button>
            </div>

            <!-- Canvas Size Controls -->
            <div class="toolbar-section size-controls">
                <label for="canvasWidth">Width:</label>
                <input type="number" id="canvasWidth" value="1200" min="800" max="3000" step="100">
                <label for="canvasHeight">Height:</label>
                <input type="number" id="canvasHeight" value="800" min="600" max="2000" step="100">
                <button class="btn-secondary" id="resizeCanvasBtn">Resize</button>
            </div>

            <!-- Zoom Controls -->
            <div class="toolbar-section zoom-controls">
                <label for="zoomLevel">Zoom:</label>
                <input type="range" id="zoomLevel" min="25" max="200" value="100" step="25">
                <span id="zoomDisplay">100%</span>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Canvas Area (75% width) -->
            <div class="canvas-area">
                <div class="canvas-container">
                    <canvas id="editorCanvas" width="1200" height="800"></canvas>
                </div>

                <!-- Creation Panel (floating within canvas area) -->
                <div class="creation-panel">
                    <h3>Add Node</h3>
                    <div class="color-selector">
                        <button class="color-btn" data-color="Red" style="background-color: #FF6467;"></button>
                        <button class="color-btn" data-color="Yellow" style="background-color: #FFDF20;"></button>
                        <button class="color-btn" data-color="Green" style="background-color: #4CAF50;"></button>
                        <button class="color-btn" data-color="Blue" style="background-color: #51A2FF;"></button>
                        <button class="color-btn" data-color="Purple" style="background-color: #9C27B0;"></button>
                        <button class="color-btn" data-color="Grey" style="background-color: #757575;"></button>
                    </div>
                    <button class="btn-primary" id="createNodeBtn">Create Node</button>
                </div>
            </div>

            <!-- Properties Panel (25% width) -->
            <div class="properties-panel">
                <div class="panel-header">
                    <h2>Node Properties</h2>
                </div>

                <div class="panel-content">
                    <!-- Node Editor Form -->
                    <div class="node-editor" id="nodeEditor" style="display: none;">
                        <div class="property-group">
                            <label for="nodeId">Node ID:</label>
                            <input type="text" id="nodeId" placeholder="e.g., NODE001">
                        </div>

                        <div class="property-group" id="descriptionGroup">
                            <label for="nodeDescription">Description:</label>
                            <textarea id="nodeDescription" rows="3" placeholder="Node description text"></textarea>
                        </div>

                        <div class="property-group">
                            <label for="nodeEffectDesc">Effect Description:</label>
                            <textarea id="nodeEffectDesc" rows="2" placeholder="Human-readable effect description"></textarea>
                        </div>

                        <div class="property-group" id="effect1Group">
                            <label for="nodeEffect1">Effect 1:</label>
                            <input type="text" id="nodeEffect1" placeholder="Examples: None;+;5;Damage OR None;%;10;Money OR PrevDam;+;5;Money">
                        </div>

                        <div class="property-group" id="effect2Group">
                            <label for="nodeEffect2">Effect 2:</label>
                            <input type="text" id="nodeEffect2" placeholder="Examples: RunnerType:Hacker;-;2;Risk OR PrevRisk;%;10;Grit">
                            <small style="display:block; color:#888; font-size:11px; margin-top:4px;">
                                <strong>Operators:</strong> + (add), - (subtract), * (multiply), / (divide), % (percentage)<br>
                                <strong>Conditions:</strong> None, RunnerType:[type], RunnerStat:[stat]>=[threshold], NodeColor:[color], NodeColorCombo:[colors], PrevDam (damage prevented), PrevRisk (risk prevented), RiskDamPair (damage+risk pairs), ColorForEach (unique colors)
                            </small>
                        </div>

                        <div class="property-group" id="gateConditionGroup" style="display: none;">
                            <label for="nodeGateCondition">Gate Condition:</label>
                            <input type="text" id="nodeGateCondition" placeholder="RunnerType:hacker,muscle;3">
                            <small style="display:block; color:#888; font-size:11px; margin-top:4px;">
                                Format: RunnerType:{types};{amount} or RunnerStat:{stats};{amount}
                            </small>
                        </div>

                        <div class="property-group">
                            <label for="nodeType">Type:</label>
                            <select id="nodeType">
                                <option value="Normal">Normal</option>
                                <option value="Synergy">Synergy</option>
                                <option value="Special">Special</option>
                                <option value="Gate">Gate</option>
                            </select>
                        </div>

                        <div class="property-group">
                            <label for="nodeColor">Color:</label>
                            <select id="nodeColor">
                                <option value="Red">Red</option>
                                <option value="Yellow">Yellow</option>
                                <option value="Green">Green</option>
                                <option value="Blue">Blue</option>
                                <option value="Purple">Purple</option>
                                <option value="Grey">Grey</option>
                            </select>
                        </div>

                        <div class="property-group">
                            <label for="nodeConnections">Connections:</label>
                            <input type="text" id="nodeConnections" placeholder="NODE002,NODE003">
                        </div>

                        <!-- Position Info -->
                        <div class="property-group">
                            <label>Position:</label>
                            <div class="position-inputs">
                                <input type="number" id="nodeX" placeholder="X" readonly>
                                <input type="number" id="nodeY" placeholder="Y" readonly>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="property-actions">
                            <button class="btn-primary" id="updateNodeBtn">Update Node</button>
                            <button class="btn-danger" id="deleteNodeBtn">Delete Node</button>
                        </div>
                    </div>

                    <!-- No Selection State -->
                    <div class="no-selection" id="noSelection">
                        <p>Click on a node to edit its properties, or click on the canvas to create a new node.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <span id="statusMessage">Ready</span>
        <span id="nodeCount">Nodes: 0</span>
        <span id="canvasInfo">Canvas: 1200x800</span>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/utils/textUtils.js"></script>
    <script src="js/utils/validationUtils.js"></script>
    <script src="js/utils/connectionUtils.js"></script>
    <script src="js/editor/editorCanvas.js"></script>
    <script src="js/editor/nodeManager.js"></script>
    <script src="js/editor/connectionManager.js"></script>
    <script src="js/editor/fileManager.js"></script>
    <script src="js/editor/editorMain.js"></script>
</body>
</html>