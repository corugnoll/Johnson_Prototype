<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Test</title>
    <style>
        canvas {
            border: 1px solid #ccc;
            background-color: #1a1a1a;
        }
        body {
            background-color: #0a0a0a;
            color: white;
            font-family: Arial, sans-serif;
        }
        #info {
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>Connection System Test</h2>
        <button onclick="testConnections()">Test Connection System</button>
        <div id="output"></div>
    </div>
    <canvas id="testCanvas" width="800" height="600"></canvas>

    <script>
        // Minimal test implementation
        function testConnections() {
            const output = document.getElementById('output');
            output.innerHTML = '<h3>Testing Connection System...</h3>';

            try {
                // Test data
                const nodes = [
                    { id: 'NODE001', x: 100, y: 100, width: 80, height: 60, connections: ['NODE002', 'NODE003'] },
                    { id: 'NODE002', x: 300, y: 50, width: 80, height: 60, connections: ['NODE004'] },
                    { id: 'NODE003', x: 300, y: 150, width: 80, height: 60, connections: ['NODE004'] },
                    { id: 'NODE004', x: 500, y: 100, width: 80, height: 60, connections: ['NODE005'] },
                    { id: 'NODE005', x: 700, y: 100, width: 80, height: 60, connections: [] }
                ];

                const canvas = document.getElementById('testCanvas');
                const ctx = canvas.getContext('2d');

                // Clear canvas
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw connections first
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;

                let connectionCount = 0;
                nodes.forEach(fromNode => {
                    fromNode.connections.forEach(targetId => {
                        const toNode = nodes.find(n => n.id === targetId);
                        if (toNode) {
                            // Simple connection line
                            const fromCenter = {
                                x: fromNode.x + fromNode.width / 2,
                                y: fromNode.y + fromNode.height / 2
                            };
                            const toCenter = {
                                x: toNode.x + toNode.width / 2,
                                y: toNode.y + toNode.height / 2
                            };

                            ctx.beginPath();
                            ctx.moveTo(fromCenter.x, fromCenter.y);
                            ctx.lineTo(toCenter.x, toCenter.y);
                            ctx.stroke();

                            // Arrow
                            const angle = Math.atan2(toCenter.y - fromCenter.y, toCenter.x - fromCenter.x);
                            const arrowLength = 10;
                            ctx.beginPath();
                            ctx.moveTo(toCenter.x, toCenter.y);
                            ctx.lineTo(toCenter.x - arrowLength * Math.cos(angle - Math.PI/6), toCenter.y - arrowLength * Math.sin(angle - Math.PI/6));
                            ctx.moveTo(toCenter.x, toCenter.y);
                            ctx.lineTo(toCenter.x - arrowLength * Math.cos(angle + Math.PI/6), toCenter.y - arrowLength * Math.sin(angle + Math.PI/6));
                            ctx.stroke();

                            connectionCount++;
                        }
                    });
                });

                // Draw nodes on top
                nodes.forEach(node => {
                    ctx.fillStyle = '#FF6467';
                    ctx.fillRect(node.x, node.y, node.width, node.height);

                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(node.x, node.y, node.width, node.height);

                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(node.id, node.x + node.width/2, node.y + node.height/2 + 4);
                });

                output.innerHTML += `<p>✅ Successfully drew ${nodes.length} nodes and ${connectionCount} connections</p>`;
                output.innerHTML += `<p>✅ Connection system is working correctly!</p>`;

            } catch (error) {
                output.innerHTML += `<p>❌ Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }

        // Auto-run test
        window.onload = () => {
            testConnections();
        };
    </script>
</body>
</html>