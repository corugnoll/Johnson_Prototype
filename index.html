<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Johnson Prototype - Cyberpunk Simulation Game</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="Tools/node_modules/papaparse/papaparse.min.js"></script>
    <script src="js/contractLibrary.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="game-board" role="main" aria-label="Game Board">
            <h2>Contract Tree</h2>
            <div class="canvas-container">
                <canvas id="gameCanvas" aria-label="Contract node visualization"></canvas>
            </div>
        </header>

        <aside class="setup-section" role="complementary" aria-label="Runner Setup">
            <h2>Runner Configuration</h2>
            <div class="runner-slots">
                <div class="runner-slot" data-slot="0">
                    <h3>Runner 1</h3>
                    <label for="runner1-type">Type:</label>
                    <select id="runner1-type" name="runner1-type" aria-label="Runner 1 Type">
                        <option value="Empty">Empty</option>
                        <option value="Face">Face</option>
                        <option value="Muscle">Muscle</option>
                        <option value="Hacker">Hacker</option>
                        <option value="Ninja">Ninja</option>
                    </select>

                    <div class="runner-stats">
                        <label for="runner1-face">Face Stat:</label>
                        <input type="number" id="runner1-face" name="runner1-face" min="0" max="10" value="0" aria-label="Runner 1 Face Stat">

                        <label for="runner1-muscle">Muscle Stat:</label>
                        <input type="number" id="runner1-muscle" name="runner1-muscle" min="0" max="10" value="0" aria-label="Runner 1 Muscle Stat">

                        <label for="runner1-hacker">Hacker Stat:</label>
                        <input type="number" id="runner1-hacker" name="runner1-hacker" min="0" max="10" value="0" aria-label="Runner 1 Hacker Stat">

                        <label for="runner1-ninja">Ninja Stat:</label>
                        <input type="number" id="runner1-ninja" name="runner1-ninja" min="0" max="10" value="0" aria-label="Runner 1 Ninja Stat">
                    </div>
                </div>

                <div class="runner-slot" data-slot="1">
                    <h3>Runner 2</h3>
                    <label for="runner2-type">Type:</label>
                    <select id="runner2-type" name="runner2-type" aria-label="Runner 2 Type">
                        <option value="Empty">Empty</option>
                        <option value="Face">Face</option>
                        <option value="Muscle">Muscle</option>
                        <option value="Hacker">Hacker</option>
                        <option value="Ninja">Ninja</option>
                    </select>

                    <div class="runner-stats">
                        <label for="runner2-face">Face Stat:</label>
                        <input type="number" id="runner2-face" name="runner2-face" min="0" max="10" value="0" aria-label="Runner 2 Face Stat">

                        <label for="runner2-muscle">Muscle Stat:</label>
                        <input type="number" id="runner2-muscle" name="runner2-muscle" min="0" max="10" value="0" aria-label="Runner 2 Muscle Stat">

                        <label for="runner2-hacker">Hacker Stat:</label>
                        <input type="number" id="runner2-hacker" name="runner2-hacker" min="0" max="10" value="0" aria-label="Runner 2 Hacker Stat">

                        <label for="runner2-ninja">Ninja Stat:</label>
                        <input type="number" id="runner2-ninja" name="runner2-ninja" min="0" max="10" value="0" aria-label="Runner 2 Ninja Stat">
                    </div>
                </div>

                <div class="runner-slot" data-slot="2">
                    <h3>Runner 3</h3>
                    <label for="runner3-type">Type:</label>
                    <select id="runner3-type" name="runner3-type" aria-label="Runner 3 Type">
                        <option value="Empty">Empty</option>
                        <option value="Face">Face</option>
                        <option value="Muscle">Muscle</option>
                        <option value="Hacker">Hacker</option>
                        <option value="Ninja">Ninja</option>
                    </select>

                    <div class="runner-stats">
                        <label for="runner3-face">Face Stat:</label>
                        <input type="number" id="runner3-face" name="runner3-face" min="0" max="10" value="0" aria-label="Runner 3 Face Stat">

                        <label for="runner3-muscle">Muscle Stat:</label>
                        <input type="number" id="runner3-muscle" name="runner3-muscle" min="0" max="10" value="0" aria-label="Runner 3 Muscle Stat">

                        <label for="runner3-hacker">Hacker Stat:</label>
                        <input type="number" id="runner3-hacker" name="runner3-hacker" min="0" max="10" value="0" aria-label="Runner 3 Hacker Stat">

                        <label for="runner3-ninja">Ninja Stat:</label>
                        <input type="number" id="runner3-ninja" name="runner3-ninja" min="0" max="10" value="0" aria-label="Runner 3 Ninja Stat">
                    </div>
                </div>
            </div>
        </aside>

        <aside class="game-state-section" role="complementary" aria-label="Game State">
            <h2>Game State</h2>
            <div class="player-info">
                <div class="stat-display">
                    <label for="player-money">Player Money:</label>
                    <span id="player-money" class="stat-value" aria-label="Current player money">$0</span>
                </div>

                <div class="stat-display">
                    <label for="player-risk">Player Risk:</label>
                    <span id="player-risk" class="stat-value" aria-label="Current player risk">0</span>
                </div>

                <div class="stat-display">
                    <label for="contracts-completed">Contracts Completed:</label>
                    <span id="contracts-completed" class="stat-value" aria-label="Number of completed contracts">0</span>
                </div>
            </div>

            <div class="loading-status">
                <p id="loading-message" aria-live="polite">Ready to load contract</p>
            </div>
        </aside>

        <footer class="options-section" role="complementary" aria-label="Contract Options">
            <h2>Contract Options</h2>
            <div class="contract-controls">
                <div class="file-input-group">
                    <label for="contract-dropdown">Select Contract:</label>
                    <select id="contract-dropdown" name="contract-dropdown" aria-label="Select pre-loaded contract">
                        <option value="">Choose a contract...</option>
                        <!-- Automatically populated from CONTRACT_LIBRARY -->
                    </select>
                </div>

                <div class="file-input-group">
                    <label for="contract-file">Or Upload Custom:</label>
                    <input type="file" id="contract-file" name="contract-file" accept=".csv" aria-label="Select contract CSV file">
                </div>

                <div class="contract-info">
                    <span id="contract-name" class="contract-title">No contract loaded</span>
                </div>

                <div class="action-buttons">
                    <button type="button" id="validate-config" disabled aria-label="Validate runner configuration">Validate Configuration</button>
                    <button type="button" id="execute-contract" disabled aria-label="Execute contract">Execute Contract</button>
                </div>
            </div>
        </footer>

        <section class="preview-section" role="complementary" aria-label="Current Pools Preview">
            <h2>Current Pools</h2>
            <div class="pools-display">
                <div class="pool-item">
                    <label>Damage:</label>
                    <span id="current-damage" class="pool-value">0</span>
                </div>
                <div class="pool-item">
                    <label>Risk:</label>
                    <span id="current-risk" class="pool-value">0</span>
                </div>
                <div class="pool-item">
                    <label>Money:</label>
                    <span id="current-money" class="pool-value">$0</span>
                </div>
                <div class="pool-item">
                    <label>Grit:</label>
                    <span id="current-grit" class="pool-value">0</span>
                </div>
                <div class="pool-item">
                    <label>Veil:</label>
                    <span id="current-veil" class="pool-value">0</span>
                </div>
            </div>
            <div id="prevention-info" class="prevention-display" style="display: none;"></div>
        </section>
    </div>

    <!-- Contract Execution Results Modal -->
    <div id="results-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Contract Execution Results</h2>
                <button type="button" id="close-results" class="close-button" aria-label="Close results">&times;</button>
            </div>
            <div class="modal-body">
                <div class="execution-status">
                    <h3 id="execution-outcome">Contract Completed!</h3>
                    <p id="execution-message">Your team has successfully completed the contract.</p>
                </div>

                <div class="results-comparison">
                    <div class="comparison-section">
                        <h4>Before Execution</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <label>Money:</label>
                                <span id="before-money">$0</span>
                            </div>
                            <div class="stat-item">
                                <label>Risk:</label>
                                <span id="before-risk">0</span>
                            </div>
                            <div class="stat-item">
                                <label>Contracts:</label>
                                <span id="before-contracts">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-section">
                        <h4>After Execution</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <label>Money:</label>
                                <span id="after-money">$0</span>
                            </div>
                            <div class="stat-item">
                                <label>Risk:</label>
                                <span id="after-risk">0</span>
                            </div>
                            <div class="stat-item">
                                <label>Contracts:</label>
                                <span id="after-contracts">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="execution-details">
                    <h4>Execution Summary</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>Final Damage:</label>
                            <span id="final-damage">0</span>
                        </div>
                        <div class="detail-item">
                            <label>Final Risk:</label>
                            <span id="final-risk">0</span>
                        </div>
                        <div class="detail-item">
                            <label>Money Earned:</label>
                            <span id="money-earned">$0</span>
                        </div>
                        <div class="detail-item">
                            <label>Prevention Applied:</label>
                            <span id="prevention-applied">None</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="start-new-contract" class="btn btn-primary">Start New Contract</button>
                <button type="button" id="continue-session" class="btn btn-secondary">Continue Session</button>
            </div>
        </div>
    </div>

    <script src="js/utils/textUtils.js"></script>
    <script src="js/utils/validationUtils.js"></script>
    <script src="js/utils/connectionUtils.js"></script>
    <script src="js/csvLoader.js"></script>
    <script src="js/gameState.js"></script>
    <script src="js/visualPrototype.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>