<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Johnson Prototype - Cyberpunk Simulation Game</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="Tools/node_modules/papaparse/papaparse.min.js"></script>
    <script src="js/contractLibrary.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="game-board" role="main" aria-label="Game Board">
            <h2>Contract Tree</h2>
            <div class="canvas-container">
                <canvas id="gameCanvas" aria-label="Contract node visualization"></canvas>
            </div>
        </header>

        <aside class="setup-section" role="complementary" aria-label="Hired Runners">
            <h2>Hired Runners</h2>

            <!-- Runner Slots Display -->
            <div class="hired-runner-slots">
                <div class="hired-runner-slot" data-slot="0">
                    <div class="empty-slot-message">Empty Slot</div>
                </div>
                <div class="hired-runner-slot" data-slot="1">
                    <div class="empty-slot-message">Empty Slot</div>
                </div>
                <div class="hired-runner-slot" data-slot="2">
                    <div class="empty-slot-message">Empty Slot</div>
                </div>
            </div>

            <!-- Stat Summary -->
            <div class="stat-summary">
                <h3>Total Stats</h3>
                <div class="stat-summary-grid">
                    <div class="stat-summary-item">
                        <label>Face:</label>
                        <span id="total-face-stat">0</span>
                    </div>
                    <div class="stat-summary-item">
                        <label>Muscle:</label>
                        <span id="total-muscle-stat">0</span>
                    </div>
                    <div class="stat-summary-item">
                        <label>Hacker:</label>
                        <span id="total-hacker-stat">0</span>
                    </div>
                    <div class="stat-summary-item">
                        <label>Ninja:</label>
                        <span id="total-ninja-stat">0</span>
                    </div>
                </div>
            </div>

            <!-- Runner Index Toggle Button -->
            <button type="button" id="toggle-runner-index" class="btn btn-primary">Open Runner Index</button>
        </aside>

        <aside class="game-state-section" role="complementary" aria-label="Game State">
            <h2>Game State</h2>
            <div class="player-info">
                <div class="stat-display">
                    <label for="player-level">Player Level:</label>
                    <span id="player-level" class="stat-value" aria-label="Player level">0</span>
                </div>

                <div class="stat-display">
                    <label for="player-money">Player Money:</label>
                    <span id="player-money" class="stat-value" aria-label="Current player money">$0</span>
                </div>

                <div class="stat-display">
                    <label for="player-risk">Player Risk:</label>
                    <span id="player-risk" class="stat-value" aria-label="Current player risk">0</span>
                </div>

                <div class="stat-display">
                    <label for="contracts-completed">Contracts Completed:</label>
                    <span id="contracts-completed" class="stat-value" aria-label="Number of completed contracts">0</span>
                </div>
            </div>

            <div class="loading-status">
                <p id="loading-message" aria-live="polite">Ready to load contract</p>
            </div>
        </aside>

        <footer class="options-section" role="complementary" aria-label="Contract Options">
            <h2>Contract Options</h2>
            <div class="contract-controls">
                <div class="file-input-group">
                    <label for="contract-dropdown">Select Contract:</label>
                    <select id="contract-dropdown" name="contract-dropdown" aria-label="Select pre-loaded contract">
                        <option value="">Choose a contract...</option>
                        <!-- Automatically populated from CONTRACT_LIBRARY -->
                    </select>
                </div>

                <div class="file-input-group">
                    <label for="contract-file">Or Upload Custom:</label>
                    <input type="file" id="contract-file" name="contract-file" accept=".csv" aria-label="Select contract CSV file">
                </div>

                <div class="contract-info">
                    <span id="contract-name" class="contract-title">No contract loaded</span>
                </div>

                <div class="action-buttons">
                    <button type="button" id="execute-contract" disabled aria-label="Execute contract">Execute Contract</button>
                </div>
            </div>
        </footer>

        <section class="preview-section" role="complementary" aria-label="Current Pools Preview">
            <h2>Current Pools</h2>
            <div class="pools-display">
                <div class="pool-item">
                    <label>Damage:</label>
                    <span id="current-damage" class="pool-value">0</span>
                </div>
                <div class="pool-item">
                    <label>Risk:</label>
                    <span id="current-risk" class="pool-value">0</span>
                </div>
                <div class="pool-item">
                    <label>Money:</label>
                    <span id="current-money" class="pool-value">$0</span>
                </div>
                <div class="pool-item">
                    <label>Grit:</label>
                    <span id="current-grit" class="pool-value">0</span>
                </div>
                <div class="pool-item">
                    <label>Veil:</label>
                    <span id="current-veil" class="pool-value">0</span>
                </div>
            </div>
            <div id="prevention-info" class="prevention-display" style="display: none;"></div>
        </section>
    </div>

    <!-- Runner Index Modal -->
    <div id="runner-index-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content runner-index-content">
            <div class="modal-header">
                <h2>Runner Index</h2>
                <button type="button" id="close-runner-index" class="close-button" aria-label="Close runner index">&times;</button>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button type="button" class="tab-button active" data-tab="generated">Generated Runners</button>
                <button type="button" class="tab-button" data-tab="previously-hired">Previously Hired</button>
            </div>

            <div class="modal-body">
                <!-- Generated Runners Tab -->
                <div id="generated-runners-tab" class="tab-content active">
                    <div class="runner-grid" id="generated-runners-grid">
                        <!-- Populated dynamically -->
                    </div>
                    <button type="button" id="generate-new-runners" class="btn btn-secondary">Generate New Runners</button>
                </div>

                <!-- Previously Hired Tab -->
                <div id="previously-hired-tab" class="tab-content">
                    <div class="runner-grid" id="previously-hired-grid">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contract Execution Results Modal -->
    <div id="results-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Contract Execution Results</h2>
                <button type="button" id="close-results" class="close-button" aria-label="Close results">&times;</button>
            </div>
            <div class="modal-body">
                <div class="execution-status">
                    <h3 id="execution-outcome">Contract Completed!</h3>
                    <p id="execution-message">Your team has successfully completed the contract.</p>
                </div>

                <div class="results-comparison">
                    <div class="comparison-section">
                        <h4>Before Execution</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <label>Money:</label>
                                <span id="before-money">$0</span>
                            </div>
                            <div class="stat-item">
                                <label>Risk:</label>
                                <span id="before-risk">0</span>
                            </div>
                            <div class="stat-item">
                                <label>Contracts:</label>
                                <span id="before-contracts">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="comparison-section">
                        <h4>After Execution</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <label>Money:</label>
                                <span id="after-money">$0</span>
                            </div>
                            <div class="stat-item">
                                <label>Risk:</label>
                                <span id="after-risk">0</span>
                            </div>
                            <div class="stat-item">
                                <label>Contracts:</label>
                                <span id="after-contracts">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="execution-details">
                    <h4>Execution Summary</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>Final Damage:</label>
                            <span id="final-damage">0</span>
                        </div>
                        <div class="detail-item">
                            <label>Final Risk:</label>
                            <span id="final-risk">0</span>
                        </div>
                        <div class="detail-item">
                            <label>Money Earned:</label>
                            <span id="money-earned">$0</span>
                        </div>
                        <div class="detail-item">
                            <label>Prevention Applied:</label>
                            <span id="prevention-applied">None</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="start-new-contract" class="btn btn-primary">Start New Contract</button>
                <button type="button" id="continue-session" class="btn btn-secondary">Continue Session</button>
            </div>
        </div>
    </div>

    <script src="js/utils/textUtils.js"></script>
    <script src="js/utils/validationUtils.js"></script>
    <script src="js/utils/connectionUtils.js"></script>
    <script src="js/resourceData.js"></script>
    <script src="js/balancingLoader.js"></script>
    <script src="js/runnerGenerator.js"></script>
    <script src="js/damageEvaluator.js"></script>
    <script src="js/runnerManager.js"></script>
    <script src="js/contractResolution.js"></script>
    <script src="js/csvLoader.js"></script>
    <script src="js/gameState.js"></script>
    <script src="js/visualPrototype.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>